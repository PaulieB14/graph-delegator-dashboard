<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>The Graph Delegator Dashboard - Arbitrum</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            /* Dark theme (default) */
            --bg-gradient-start: #6F4CFF;
            --bg-gradient-end: #0C0A1D;
            --container-bg: #F8F6FF;
            --text-primary: #0C0A1D;
            --text-secondary: #494755;
            --border-color: rgba(73, 71, 85, 0.15);
            --card-bg: white;
            --input-bg: white;
            --shadow-color: rgba(12, 10, 29, 0.08);
            --shadow-hover: rgba(12, 10, 29, 0.15);
        }

        [data-theme="light"] {
            /* Light theme */
            --bg-gradient-start: #F8F6FF;
            --bg-gradient-end: #E8E4FF;
            --container-bg: white;
            --text-primary: #0C0A1D;
            --text-secondary: #494755;
            --border-color: rgba(73, 71, 85, 0.15);
            --card-bg: #F8F6FF;
            --input-bg: #F8F6FF;
            --shadow-color: rgba(111, 76, 255, 0.08);
            --shadow-hover: rgba(111, 76, 255, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, var(--bg-gradient-start) 0%, var(--bg-gradient-end) 100%);
            min-height: 100vh;
            padding: 10px;
            color: var(--text-primary);
            transition: all 0.3s ease;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: var(--container-bg);
            border-radius: 20px;
            box-shadow: 0 32px 64px rgba(12, 10, 29, 0.25);
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .header {
            background: linear-gradient(135deg, #6F4CFF 0%, #4C66FF 100%);
            color: #F8F6FF;
            padding: 40px 20px;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .header::before {
            content: '';
            position: absolute;
            top: -50%;
            left: -50%;
            width: 200%;
            height: 200%;
            background: 
                radial-gradient(circle at 25% 25%, rgba(248,246,255,0.15) 0%, transparent 50%),
                radial-gradient(circle at 75% 75%, rgba(248,246,255,0.1) 0%, transparent 50%);
            animation: float 20s ease-in-out infinite;
        }

        @keyframes float {
            0%, 100% { transform: rotate(0deg) scale(1); }
            50% { transform: rotate(180deg) scale(1.1); }
        }

        .header-content {
            position: relative;
            z-index: 1;
        }

        .brand-logo {
            display: inline-flex;
            align-items: center;
            gap: 16px;
            margin-bottom: 20px;
            flex-wrap: wrap;
            justify-content: center;
        }

        .graph-logomark {
            width: 48px;
            height: 48px;
            filter: drop-shadow(0 8px 16px rgba(0,0,0,0.2));
            flex-shrink: 0;
        }

        .graph-logomark path {
            fill: #F8F6FF;
        }

        .graph-wordmark {
            height: 36px;
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.2));
            flex-shrink: 0;
        }

        .graph-wordmark path {
            fill: #F8F6FF;
        }

        .header h1 {
            font-size: 1.8rem;
            margin-bottom: 12px;
            font-weight: 700;
            letter-spacing: -0.01em;
        }

        .header p {
            font-size: 1rem;
            opacity: 0.95;
            max-width: 500px;
            margin: 0 auto;
            line-height: 1.5;
            font-weight: 400;
        }

        .network-badge {
            display: inline-block;
            background: rgba(248, 246, 255, 0.2);
            border: 1px solid rgba(248, 246, 255, 0.3);
            color: #F8F6FF;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            margin-top: 12px;
            backdrop-filter: blur(10px);
        }

        .controls-bar {
            position: absolute;
            top: 15px;
            right: 15px;
            display: flex;
            gap: 8px;
            z-index: 2;
        }

        .theme-toggle {
            background: rgba(248, 246, 255, 0.2);
            border: 1px solid rgba(248, 246, 255, 0.3);
            color: #F8F6FF;
            padding: 8px 12px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.8rem;
            font-weight: 600;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
            white-space: nowrap;
        }

        .theme-toggle:hover {
            background: rgba(248, 246, 255, 0.3);
            transform: translateY(-2px);
        }

        .search-section {
            padding: 30px 20px;
            background: var(--container-bg);
            border-bottom: 1px solid var(--border-color);
            transition: all 0.3s ease;
        }

        .search-box {
            display: flex;
            flex-direction: column;
            gap: 16px;
            max-width: 600px;
            margin: 0 auto;
        }

        .search-input {
            width: 100%;
            padding: 16px 20px;
            border: 2px solid var(--border-color);
            border-radius: 12px;
            font-size: 16px;
            background: var(--input-bg);
            color: var(--text-primary);
            font-family: 'Inter', sans-serif;
            font-weight: 500;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: 0 4px 12px var(--shadow-color);
        }

        .search-input:focus {
            outline: none;
            border-color: #6F4CFF;
            box-shadow: 0 0 0 4px rgba(111, 76, 255, 0.12), 0 8px 24px rgba(0, 0, 0, 0.1);
        }

        .search-btn {
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, #6F4CFF 0%, #4C66FF 100%);
            color: #F8F6FF;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            font-family: 'Inter', sans-serif;
            box-shadow: 0 8px 24px rgba(111, 76, 255, 0.3);
        }

        .search-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 12px 32px rgba(111, 76, 255, 0.4);
        }

        .search-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .results {
            padding: 30px 20px;
            background: var(--container-bg);
            transition: all 0.3s ease;
        }

        .filters-section {
            display: flex;
            justify-content: center;
            gap: 12px;
            margin-bottom: 24px;
            flex-wrap: wrap;
        }

        .filter-btn {
            padding: 10px 20px;
            border: 2px solid var(--border-color);
            background: var(--card-bg);
            color: var(--text-secondary);
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Inter', sans-serif;
        }

        .filter-btn.active {
            background: linear-gradient(135deg, #6F4CFF 0%, #4C66FF 100%);
            color: #F8F6FF;
            border-color: #6F4CFF;
            box-shadow: 0 4px 12px rgba(111, 76, 255, 0.3);
        }

        .filter-btn:hover:not(.active) {
            border-color: #6F4CFF;
            color: #6F4CFF;
            transform: translateY(-2px);
        }

        .portfolio-summary {
            background: linear-gradient(135deg, #6F4CFF 0%, #4C66FF 100%);
            border-radius: 20px;
            padding: 30px 20px;
            margin-bottom: 30px;
            color: #F8F6FF;
            box-shadow: 0 20px 40px rgba(111, 76, 255, 0.25);
            position: relative;
            overflow: hidden;
        }

        .portfolio-summary::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 150px;
            height: 150px;
            background: radial-gradient(circle, rgba(248,246,255,0.1) 0%, transparent 70%);
            border-radius: 50%;
            transform: translate(50%, -50%);
        }

        .portfolio-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 24px;
            display: flex;
            align-items: center;
            gap: 8px;
            position: relative;
            z-index: 1;
            justify-content: center;
            text-align: center;
        }

        .portfolio-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 16px;
            position: relative;
            z-index: 1;
        }

        .stat-item {
            text-align: center;
            background: rgba(248, 246, 255, 0.15);
            padding: 20px 12px;
            border-radius: 16px;
            backdrop-filter: blur(20px);
            border: 1px solid rgba(248, 246, 255, 0.2);
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 800;
            margin-bottom: 6px;
            letter-spacing: -0.02em;
        }

        .stat-label {
            font-size: 0.85rem;
            opacity: 0.9;
            font-weight: 500;
            line-height: 1.2;
        }

        .delegation-card {
            background: var(--card-bg);
            border: 1px solid var(--border-color);
            border-radius: 20px;
            padding: 24px 20px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px var(--shadow-color);
            transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .delegation-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 48px var(--shadow-hover);
            border-color: rgba(111, 76, 255, 0.3);
        }

        .delegation-card.inactive {
            opacity: 0.7;
            display: none;
        }

        .delegation-card.inactive.show-inactive {
            display: block;
        }

        .indexer-header {
            display: flex;
            flex-direction: column;
            gap: 16px;
            margin-bottom: 24px;
        }

        .indexer-info {
            display: flex;
            align-items: flex-start;
            gap: 16px;
            flex: 1;
        }

        .indexer-avatar {
            width: 60px;
            height: 60px;
            border-radius: 16px;
            background: linear-gradient(135deg, #6F4CFF 0%, #4C66FF 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            color: #F8F6FF;
            font-weight: 800;
            font-size: 1.5rem;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 8px 16px rgba(111, 76, 255, 0.3);
            border: 2px solid rgba(248, 246, 255, 0.2);
        }

        .indexer-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 14px;
        }

        .indexer-details-header {
            flex: 1;
            min-width: 0;
        }

        .indexer-name {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 8px;
            letter-spacing: -0.01em;
            transition: color 0.3s ease;
            line-height: 1.2;
        }

        .indexer-description {
            font-size: 0.9rem;
            color: var(--text-secondary);
            line-height: 1.4;
            margin-bottom: 12px;
            max-height: 60px;
            overflow: hidden;
            text-overflow: ellipsis;
            transition: color 0.3s ease;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
        }

        .indexer-links {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .indexer-url {
            color: #6F4CFF;
            text-decoration: none;
            font-size: 0.85rem;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 8px 12px;
            background: rgba(111, 76, 255, 0.08);
            border-radius: 10px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(111, 76, 255, 0.2);
        }

        .indexer-url:hover {
            background: #6F4CFF;
            color: #F8F6FF;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(111, 76, 255, 0.3);
        }

        .status-badge {
            padding: 10px 16px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            text-transform: uppercase;
            white-space: nowrap;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            letter-spacing: 0.02em;
            align-self: flex-start;
        }

        .status-active {
            background: linear-gradient(135deg, #4BCA81 0%, #66D8FF 100%);
            color: white;
        }

        .status-inactive {
            background: linear-gradient(135deg, #FF79C6 0%, #FF6B9D 100%);
            color: white;
        }

        .status-mixed {
            background: linear-gradient(135deg, #FFA801 0%, #FF6B9D 100%);
            color: white;
        }

        .delegation-stats {
            display: grid;
            grid-template-columns: 1fr;
            gap: 12px;
        }

        .delegation-stat {
            text-align: center;
            padding: 16px;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(111, 76, 255, 0.04) 100%);
            border: 1px solid var(--border-color);
            border-radius: 16px;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .delegation-stat:hover {
            border-color: rgba(111, 76, 255, 0.3);
            transform: translateY(-2px);
            box-shadow: 0 8px 16px rgba(111, 76, 255, 0.1);
        }

        .delegation-stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 6px;
            letter-spacing: -0.01em;
            transition: color 0.3s ease;
        }

        .delegation-stat-label {
            font-size: 0.85rem;
            color: var(--text-secondary);
            font-weight: 600;
            transition: color 0.3s ease;
        }

        .stake-count-badge {
            background: rgba(111, 76, 255, 0.1);
            color: #6F4CFF;
            padding: 4px 8px;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
            margin-left: 8px;
        }

        .gain-positive {
            color: #4BCA81;
        }

        .gain-negative {
            color: #FF79C6;
        }

        .powered-by {
            background: linear-gradient(135deg, #4BCA81 0%, #66D8FF 100%);
            border-radius: 20px;
            padding: 30px 20px;
            margin: 30px 0;
            color: white;
            text-align: center;
            box-shadow: 0 20px 40px rgba(75, 202, 129, 0.25);
        }

        .powered-by h3 {
            margin-bottom: 12px;
            font-size: 1.3rem;
            font-weight: 700;
        }

        .powered-by p {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .loading {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
            font-size: 1.1rem;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .error {
            background: linear-gradient(135deg, #FF79C6 0%, #FF6B9D 100%);
            color: white;
            border-radius: 16px;
            padding: 24px 20px;
            margin: 24px 0;
            box-shadow: 0 16px 32px rgba(255, 121, 198, 0.25);
        }

        .error h3 {
            margin-bottom: 8px;
            font-size: 1.2rem;
            font-weight: 700;
        }

        .error p {
            font-size: 0.9rem;
            line-height: 1.4;
        }

        .error-details {
            margin-top: 12px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 10px;
            font-family: 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            word-break: break-word;
            line-height: 1.3;
        }

        .demo-addresses {
            margin-top: 24px;
            padding: 24px 20px;
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--border-color);
            box-shadow: 0 8px 24px var(--shadow-color);
            transition: all 0.3s ease;
        }

        .demo-title {
            font-weight: 700;
            color: var(--text-primary);
            margin-bottom: 16px;
            font-size: 1rem;
            transition: color 0.3s ease;
            text-align: center;
        }

        .demo-address {
            display: block;
            background: linear-gradient(135deg, var(--card-bg) 0%, rgba(111, 76, 255, 0.04) 100%);
            padding: 12px 16px;
            margin: 8px 0;
            border-radius: 12px;
            font-family: 'SF Mono', 'Monaco', 'Menlo', monospace;
            font-size: 0.8rem;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid var(--border-color);
            font-weight: 600;
            color: var(--text-primary);
            text-align: center;
            word-break: break-all;
        }

        .demo-address:hover {
            background: #6F4CFF;
            color: #F8F6FF;
            transform: translateY(-2px);
            box-shadow: 0 6px 16px rgba(111, 76, 255, 0.3);
        }

        .created-date {
            font-size: 0.8rem;
            color: var(--text-secondary);
            margin-top: 6px;
            font-weight: 500;
            transition: color 0.3s ease;
        }

        .retry-btn {
            margin-top: 12px;
            padding: 10px 20px;
            background: rgba(255, 255, 255, 0.2);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 10px;
            font-size: 0.85rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .retry-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: translateY(-2px);
        }

        .section-title {
            margin-bottom: 24px;
            color: var(--text-primary);
            font-size: 1.5rem;
            font-weight: 700;
            text-align: center;
        }

        /* Tablet styles */
        @media (min-width: 768px) {
            body {
                padding: 20px;
            }

            .container {
                border-radius: 24px;
            }

            .header {
                padding: 60px 40px;
            }

            .brand-logo {
                gap: 20px;
                margin-bottom: 24px;
            }

            .graph-logomark {
                width: 64px;
                height: 64px;
            }

            .graph-wordmark {
                height: 48px;
            }

            .header h1 {
                font-size: 2.2rem;
                margin-bottom: 16px;
            }

            .header p {
                font-size: 1.25rem;
            }

            .controls-bar {
                top: 20px;
                right: 20px;
            }

            .theme-toggle {
                padding: 12px 16px;
                font-size: 0.9rem;
            }

            .search-section {
                padding: 60px 40px;
            }

            .search-box {
                flex-direction: row;
                gap: 20px;
                max-width: 700px;
            }

            .search-input {
                padding: 20px 28px;
                border-radius: 16px;
            }

            .search-btn {
                width: auto;
                padding: 20px 36px;
                border-radius: 16px;
            }

            .results {
                padding: 60px 40px;
            }

            .portfolio-summary {
                padding: 48px;
                margin-bottom: 48px;
                border-radius: 24px;
            }

            .portfolio-title {
                font-size: 2rem;
                margin-bottom: 32px;
                justify-content: flex-start;
            }

            .portfolio-stats {
                grid-template-columns: repeat(4, 1fr);
                gap: 32px;
            }

            .stat-item {
                padding: 24px;
                border-radius: 20px;
            }

            .stat-value {
                font-size: 2.25rem;
                margin-bottom: 8px;
            }

            .stat-label {
                font-size: 1rem;
            }

            .delegation-card {
                padding: 36px;
                margin-bottom: 32px;
                border-radius: 24px;
            }

            .indexer-header {
                flex-direction: row;
                justify-content: space-between;
                align-items: flex-start;
                gap: 24px;
                margin-bottom: 32px;
            }

            .indexer-info {
                gap: 24px;
            }

            .indexer-avatar {
                width: 88px;
                height: 88px;
                border-radius: 20px;
                font-size: 2.2rem;
            }

            .indexer-name {
                font-size: 1.75rem;
                margin-bottom: 12px;
            }

            .indexer-description {
                font-size: 1rem;
                margin-bottom: 16px;
                max-height: 96px;
                -webkit-line-clamp: 4;
            }

            .indexer-links {
                gap: 16px;
            }

            .indexer-url {
                font-size: 1rem;
                padding: 10px 16px;
                border-radius: 12px;
            }

            .status-badge {
                padding: 14px 24px;
                border-radius: 32px;
                font-size: 0.9rem;
            }

            .delegation-stats {
                grid-template-columns: repeat(3, 1fr);
                gap: 24px;
            }

            .delegation-stat {
                padding: 24px;
                border-radius: 20px;
            }

            .delegation-stat-value {
                font-size: 1.5rem;
                margin-bottom: 8px;
            }

            .delegation-stat-label {
                font-size: 0.95rem;
            }

            .section-title {
                font-size: 2rem;
                text-align: left;
                margin-bottom: 32px;
            }
        }

        /* Desktop styles */
        @media (min-width: 1024px) {
            .portfolio-stats {
                grid-template-columns: repeat(4, 1fr);
            }

            .delegation-stats {
                grid-template-columns: repeat(3, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="controls-bar">
                <button class="theme-toggle" onclick="toggleTheme()">
                    üåô Dark
                </button>
            </div>
            <div class="header-content">
                <div class="brand-logo">
                    <svg class="graph-logomark" width="64" height="64" viewBox="0 0 64 64" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M29 43.9999C19.08 43.9999 11 35.9299 11 25.9999C11 16.0699 19.08 7.9999 29 7.9999C38.92 7.9999 47 16.0699 47 25.9999C47 35.9299 38.92 43.9999 29 43.9999ZM29 13.9999C22.38 13.9999 17 19.3799 17 25.9999C17 32.6199 22.38 37.9999 29 37.9999C35.62 37.9999 41 32.6199 41 25.9999C41 19.3799 35.62 13.9999 29 13.9999ZM34.12 61.1199L46.12 49.1199C47.29 47.9499 47.29 46.0499 46.12 44.8799C44.95 43.7099 43.05 43.7099 41.88 44.8799L29.88 56.8799C28.71 58.0499 28.71 59.9499 29.88 61.1199C30.47 61.7099 31.23 61.9999 32 61.9999C32.77 61.9999 33.54 61.7099 34.12 61.1199ZM50 7.3999C48.02 7.3999 46.4 9.0199 46.4 10.9999C46.4 12.9799 48.02 14.5999 50 14.5999C51.98 14.5999 53.6 12.9799 53.6 10.9999C53.6 9.0199 51.98 7.3999 50 7.3999Z" fill="#F8F6FF"/>
                    </svg>
                    <svg class="graph-wordmark" width="208" height="48" viewBox="0 0 208 48" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M13.9729 35.2826V11.4244H21.9395V5.66841H0V11.4244H7.88321V35.2826H13.9729ZM30.9072 35.2826V25.1053C30.9072 21.1011 32.9093 19.1825 35.537 19.1825C37.9145 19.1825 39.2075 21.0177 39.2075 24.0209V35.2826H44.9218V23.0615C44.9218 17.6392 41.9187 13.9687 36.8718 13.9687C34.1606 13.9687 31.9917 15.1366 30.9072 16.805V4H25.1929V35.2826H30.9072ZM59.7706 35.7414C65.0678 35.7414 69.1971 32.6966 70.4484 28.4838H64.4838C63.8165 29.902 62.0647 30.7779 60.0626 30.7779C56.5172 30.7779 54.682 28.6507 54.4317 26.1898H70.6987C70.9906 18.3483 65.9437 13.9687 59.8123 13.9687C53.4724 13.9687 48.8426 18.5985 48.8426 24.8133C48.8426 31.1533 53.389 35.7414 59.7706 35.7414ZM64.4421 22.4359H54.6403C55.1825 20.1418 57.0177 18.5985 59.6455 18.5985C61.6058 18.5985 63.7331 19.6413 64.4421 22.4359ZM98.8113 35.7831C107.612 35.7831 114.745 29.7351 113.41 17.5558H98.1022V23.2284H107.153C106.486 27.316 103.608 29.9437 98.8113 29.9437C93.0553 29.9437 89.3014 25.7727 89.3014 20.4755C89.3014 15.1783 93.0553 11.0073 98.7279 11.0073C101.564 11.0073 104.317 12.2586 105.777 14.4275H112.701C110.699 8.83837 104.943 5.16788 98.7279 5.16788C89.7602 5.16788 83.2117 11.8832 83.2117 20.4755C83.2117 29.0678 89.7602 35.7831 98.8113 35.7831ZM123.379 35.2826V25.3139C123.379 21.8936 125.172 19.7664 127.883 19.7664C128.801 19.7664 129.593 19.9333 130.469 20.2252V14.4275C129.76 14.219 129.135 14.1773 128.551 14.1773C126.215 14.1773 124.088 15.7205 123.379 17.7643V14.4275H117.664V35.2826H123.379ZM141.856 35.7414C144.734 35.7414 146.945 34.2815 147.862 32.9468V35.2826H153.577V14.4275H147.862V16.7633C146.945 15.4286 144.734 13.9687 141.856 13.9687C136.309 13.9687 132.054 18.9322 132.054 24.8551C132.054 30.7779 136.309 35.7414 141.856 35.7414ZM143.066 30.5276C139.937 30.5276 137.81 28.1084 137.81 24.8551C137.81 21.6017 139.937 19.1825 143.066 19.1825C146.194 19.1825 148.321 21.6017 148.321 24.8551C148.321 28.1084 146.194 30.5276 143.066 30.5276ZM164.838 44V32.9468C165.798 34.2815 168.008 35.7414 170.886 35.7414C176.434 35.7414 180.688 30.7779 180.688 24.8551C180.688 18.9322 176.434 13.9687 170.886 13.9687C168.008 13.9687 165.798 15.4286 164.838 16.7633V14.4275H159.124V44H164.838ZM169.635 30.5276C166.507 30.5276 164.38 28.1084 164.38 24.8551C164.38 21.6017 166.507 19.1825 169.635 19.1825C172.763 19.1825 174.891 21.6017 174.891 24.8551C174.891 28.1084 172.763 30.5276 169.635 30.5276ZM190.574 35.2826V25.1053C190.574 21.1011 192.576 19.1825 195.203 19.1825C197.581 19.1825 198.874 21.0177 198.874 24.0209V35.2826H204.588V23.0615C204.588 17.6392 201.585 13.9687 196.538 13.9687C193.827 13.9687 191.658 15.1366 190.574 16.805V4H184.859V35.2826H190.574Z" fill="#F8F6FF"/>
                    </svg>
                </div>
                <h1>Delegator Dashboard</h1>
                <p>Analyze your delegations, track rewards, and monitor indexer performance on The Graph Network</p>
                <div class="network-badge">üîó Arbitrum Network</div>
            </div>
        </div>

        <div class="search-section">
            <div class="search-box">
                <input 
                    type="text" 
                    class="search-input" 
                    id="walletInput"
                    placeholder="Enter wallet address (0x...)"
                    value="0x25a981d1fdefcde326dd0f868795b290c88430fa"
                >
                <button class="search-btn" id="searchBtn" onclick="analyzeDelegations()">
                    Analyze Delegations
                </button>
            </div>
            
            <div class="demo-addresses">
                <div class="demo-title">üìã Try these Arbitrum demo addresses:</div>
                <div class="demo-address" onclick="setAddress('0x25a981d1fdefcde326dd0f868795b290c88430fa')">
                    0x25a981d1fdefcde326dd0f868795b290c88430fa
                </div>
                <div class="demo-address" onclick="setAddress('0xc69de45ec5e4ef1df6bef14229660c9211917d86')">
                    0xc69de45ec5e4ef1df6bef14229660c9211917d86
                </div>
                <div class="demo-address" onclick="setAddress('0x9c90de4d1eab3d7ec5dca89ddbebc2e62d3ac311')">
                    0x9c90de4d1eab3d7ec5dca89ddbebc2e62d3ac311
                </div>
            </div>
        </div>

        <div class="results" id="results">
            <div class="powered-by">
                <h3>üöÄ Ready to Use!</h3>
                <p>No API key required - just enter a wallet address above to analyze Arbitrum delegations with real-time data from The Graph Network.</p>
            </div>
        </div>
    </div>

    <script>
        let showInactive = false;

        // Theme management
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (body.getAttribute('data-theme') === 'light') {
                body.removeAttribute('data-theme');
                themeToggle.innerHTML = 'üåô Dark';
                localStorage.setItem('theme', 'dark');
            } else {
                body.setAttribute('data-theme', 'light');
                themeToggle.innerHTML = '‚òÄÔ∏è Light';
                localStorage.setItem('theme', 'light');
            }
        }

        // Load saved theme
        function loadTheme() {
            const savedTheme = localStorage.getItem('theme');
            const themeToggle = document.querySelector('.theme-toggle');
            
            if (savedTheme === 'light') {
                document.body.setAttribute('data-theme', 'light');
                themeToggle.innerHTML = '‚òÄÔ∏è Light';
            }
        }

        // Filter management
        function toggleInactiveFilter() {
            showInactive = !showInactive;
            const inactiveCards = document.querySelectorAll('.delegation-card.inactive');
            const filterBtn = document.querySelector('.filter-btn[data-filter="inactive"]');
            
            if (showInactive) {
                inactiveCards.forEach(card => card.classList.add('show-inactive'));
                filterBtn.classList.add('active');
                filterBtn.textContent = '‚úÖ Hide Inactive';
            } else {
                inactiveCards.forEach(card => card.classList.remove('show-inactive'));
                filterBtn.classList.remove('active');
                filterBtn.textContent = 'üëÅÔ∏è Show Inactive';
            }
        }

        // Suppress wallet extension errors that don't affect our functionality
        window.addEventListener('error', function(e) {
            if (e.filename && (e.filename.includes('evmAsk.js') || e.filename.includes('requestProvider.js'))) {
                e.preventDefault();
                return false;
            }
        });

        function setAddress(address) {
            document.getElementById('walletInput').value = address;
        }

        function formatGRT(wei) {
            if (!wei) return '0';
            const grt = parseFloat(wei) / 1e18;
            if (grt >= 1000000) {
                return (grt / 1000000).toFixed(2) + 'M';
            } else if (grt >= 1000) {
                return (grt / 1000).toFixed(2) + 'K';
            } else {
                return grt.toFixed(2);
            }
        }

        function formatDate(timestamp) {
            const date = new Date(timestamp * 1000);
            return date.toLocaleDateString('en-US', { 
                year: 'numeric', 
                month: 'short', 
                day: 'numeric' 
            });
        }

        function calculateUnrealizedRewards(stakedTokens, personalExchangeRate, currentExchangeRate) {
            if (!personalExchangeRate || !currentExchangeRate || !stakedTokens) return 0;
            
            const currentValue = (parseFloat(stakedTokens) * parseFloat(currentExchangeRate)) / parseFloat(personalExchangeRate);
            const unrealizedRewards = currentValue - parseFloat(stakedTokens);
            return unrealizedRewards;
        }

        function getIndexerAvatar(indexer) {
            if (indexer.account && indexer.account.metadata && indexer.account.metadata.image) {
                return `<img src="${indexer.account.metadata.image}" alt="${indexer.defaultDisplayName || 'Indexer'}" onerror="this.style.display='none'; this.parentElement.innerHTML='${getIndexerInitial(indexer)}';">`;
            }
            
            return getIndexerInitial(indexer);
        }

        function getIndexerInitial(indexer) {
            // Handle null/undefined defaultDisplayName
            if (indexer.defaultDisplayName && indexer.defaultDisplayName.length > 0) {
                return indexer.defaultDisplayName.charAt(0).toUpperCase();
            }
            
            // Fallback to account metadata displayName
            if (indexer.account && indexer.account.metadata && indexer.account.metadata.displayName) {
                return indexer.account.metadata.displayName.charAt(0).toUpperCase();
            }
            
            // Final fallback to first character of address
            return indexer.id ? indexer.id.charAt(2).toUpperCase() : '?';
        }

        function getIndexerWebsite(indexer) {
            if (indexer.account && indexer.account.metadata && indexer.account.metadata.website) {
                return indexer.account.metadata.website;
            }
            return indexer.url || '#';
        }

        function getIndexerDescription(indexer) {
            if (indexer.account && indexer.account.metadata && indexer.account.metadata.description) {
                return indexer.account.metadata.description;
            }
            return null;
        }

        function getIndexerName(indexer) {
            // Try defaultDisplayName first
            if (indexer.defaultDisplayName) {
                return indexer.defaultDisplayName;
            }
            
            // Try account metadata displayName
            if (indexer.account && indexer.account.metadata && indexer.account.metadata.displayName) {
                return indexer.account.metadata.displayName;
            }
            
            // Fallback to shortened address
            return `Indexer ${indexer.id.substring(0, 8)}...`;
        }

        function showError(title, message, details = null, showRetry = false) {
            const retryButton = showRetry ? `<button class="retry-btn" onclick="analyzeDelegations()">Try Again</button>` : '';
            const errorDetails = details ? `<div class="error-details"><strong>Technical Details:</strong><br>${details}</div>` : '';
            
            return `
                <div class="error">
                    <h3>${title}</h3>
                    <p>${message}</p>
                    ${errorDetails}
                    ${retryButton}
                </div>
            `;
        }

        // Group stakes by indexer and combine their data
        function groupStakesByIndexer(stakes) {
            const indexerGroups = new Map();
            
            stakes.forEach(stake => {
                const indexerId = stake.indexer.id;
                
                if (!indexerGroups.has(indexerId)) {
                    indexerGroups.set(indexerId, {
                        indexer: stake.indexer,
                        stakes: [],
                        totalStakedTokens: 0,
                        totalUnstakedTokens: 0,
                        totalRealizedRewards: 0,
                        hasActiveStakes: false,
                        hasInactiveStakes: false,
                        activeStakeCount: 0,
                        totalStakeCount: 0
                    });
                }
                
                const group = indexerGroups.get(indexerId);
                group.stakes.push(stake);
                group.totalStakedTokens += parseFloat(stake.stakedTokens);
                group.totalUnstakedTokens += parseFloat(stake.unstakedTokens);
                group.totalRealizedRewards += parseFloat(stake.realizedRewards);
                group.totalStakeCount++;
                
                const isActive = !stake.lastUndelegatedAt;
                if (isActive) {
                    group.hasActiveStakes = true;
                    group.activeStakeCount++;
                } else {
                    group.hasInactiveStakes = true;
                }
            });
            
            return Array.from(indexerGroups.values());
        }

        async function analyzeDelegations() {
            const walletAddress = document.getElementById('walletInput').value.trim().toLowerCase();
            const resultsDiv = document.getElementById('results');
            const searchBtn = document.getElementById('searchBtn');

            if (!walletAddress || !walletAddress.startsWith('0x')) {
                resultsDiv.innerHTML = showError(
                    'Invalid Address', 
                    'Please enter a valid wallet address starting with 0x'
                );
                return;
            }

            if (walletAddress.length !== 42) {
                resultsDiv.innerHTML = showError(
                    'Invalid Address Format', 
                    'Wallet address must be exactly 42 characters long (including 0x prefix)'
                );
                return;
            }

            searchBtn.disabled = true;
            searchBtn.textContent = 'Analyzing...';
            resultsDiv.innerHTML = '<div class="loading">üîç Fetching delegation data from The Graph Network (Arbitrum)...</div>';

            try {
                const controller = new AbortController();
                const timeoutId = setTimeout(() => controller.abort(), 30000); // 30 second timeout

                const response = await fetch('/api/delegator', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Accept': 'application/json'
                    },
                    body: JSON.stringify({ walletAddress }),
                    signal: controller.signal
                });

                clearTimeout(timeoutId);

                let data;
                try {
                    const responseText = await response.text();
                    console.log('Raw response:', responseText.substring(0, 200));
                    
                    if (!responseText.trim()) {
                        throw new Error('Empty response from server');
                    }
                    
                    data = JSON.parse(responseText);
                } catch (jsonError) {
                    console.error('JSON parsing failed:', jsonError);
                    resultsDiv.innerHTML = showError(
                        'Server Response Error',
                        'The server returned an invalid response. This might be a temporary issue.',
                        `Response status: ${response.status}. JSON parsing failed: ${jsonError.message}`,
                        true
                    );
                    return;
                }

                if (!response.ok) {
                    console.error('API error:', response.status, data);
                    let errorMessage = 'An error occurred while fetching data.';
                    let errorDetails = `HTTP ${response.status}`;
                    
                    if (data.error) {
                        errorMessage = data.error;
                        if (data.details) {
                            errorDetails += `: ${data.details}`;
                        }
                    }
                    
                    resultsDiv.innerHTML = showError(
                        'API Error',
                        errorMessage,
                        errorDetails,
                        true
                    );
                    return;
                }

                if (data.data && data.data.delegator) {
                    displayDelegatorData(data.data.delegator);
                } else {
                    resultsDiv.innerHTML = showError(
                        'No Delegator Found',
                        'This wallet address has no delegation history on The Graph Network (Arbitrum).',
                        'The wallet may not have any active or past delegations on Arbitrum.'
                    );
                }

            } catch (error) {
                console.error('Request failed:', error);
                
                let errorMessage = 'Failed to connect to The Graph Network.';
                let errorDetails = error.message;
                
                if (error.name === 'AbortError') {
                    errorMessage = 'Request timed out after 30 seconds.';
                    errorDetails = 'The Graph Network may be experiencing high load. Please try again.';
                } else if (error.name === 'TypeError' && error.message.includes('fetch')) {
                    errorMessage = 'Network connection failed.';
                    errorDetails = 'Please check your internet connection and try again.';
                }
                
                resultsDiv.innerHTML = showError(
                    'Connection Error',
                    errorMessage,
                    errorDetails,
                    true
                );
            } finally {
                searchBtn.disabled = false;
                searchBtn.textContent = 'Analyze Delegations';
            }
        }

        function displayDelegatorData(delegator) {
            const resultsDiv = document.getElementById('results');
            
            const totalStaked = formatGRT(delegator.totalStakedTokens);
            const totalRealized = formatGRT(delegator.totalRealizedRewards);
            const activeStakes = delegator.activeStakesCount;
            const totalStakes = delegator.stakesCount;

            // Group stakes by indexer
            const indexerGroups = groupStakesByIndexer(delegator.stakes);
            const uniqueIndexers = indexerGroups.length;

            // Sort indexer groups: Active/Mixed first, then Inactive
            indexerGroups.sort((a, b) => {
                // Active/Mixed status gets priority (higher values first)
                const aStatus = a.hasActiveStakes ? (a.hasInactiveStakes ? 2 : 3) : 1; // Mixed=2, Active=3, Inactive=1
                const bStatus = b.hasActiveStakes ? (b.hasInactiveStakes ? 2 : 3) : 1;
                
                if (aStatus !== bStatus) {
                    return bStatus - aStatus; // Higher status first
                }
                
                // If same status, sort by total staked amount (descending)
                return b.totalStakedTokens - a.totalStakedTokens;
            });

            let delegationsHTML = '';
            let hasInactive = false;
            
            indexerGroups.forEach(group => {
                const indexer = group.indexer;
                const hasActive = group.hasActiveStakes;
                const hasInactiveOnly = group.hasInactiveStakes && !group.hasActiveStakes;
                
                if (hasInactiveOnly) hasInactive = true;
                
                const stakedAmount = formatGRT(group.totalStakedTokens.toString());
                const realizedRewards = formatGRT(group.totalRealizedRewards.toString());
                
                // Calculate combined unrealized rewards for all stakes to this indexer
                let totalUnrealizedRewards = 0;
                group.stakes.forEach(stake => {
                    const unrealized = calculateUnrealizedRewards(
                        stake.stakedTokens,
                        stake.personalExchangeRate,
                        indexer.delegationExchangeRate
                    );
                    totalUnrealizedRewards += unrealized;
                });
                const unrealizedRewardsFormatted = formatGRT(totalUnrealizedRewards.toString());
                
                const indexerName = getIndexerName(indexer);
                const indexerWebsite = getIndexerWebsite(indexer);
                const indexerAvatar = getIndexerAvatar(indexer);
                const indexerDescription = getIndexerDescription(indexer);
                const createdDate = formatDate(indexer.createdAt);
                
                // Determine status
                let statusClass, statusText;
                if (hasActive && group.hasInactiveStakes) {
                    statusClass = 'status-mixed';
                    statusText = 'üîÑ Mixed';
                } else if (hasActive) {
                    statusClass = 'status-active';
                    statusText = '‚úÖ Active';
                } else {
                    statusClass = 'status-inactive';
                    statusText = '‚ùå Inactive';
                }
                
                const stakeCountBadge = group.totalStakeCount > 1 ? 
                    `<span class="stake-count-badge">${group.totalStakeCount} stakes</span>` : '';
                
                delegationsHTML += `
                    <div class="delegation-card ${hasInactiveOnly ? 'inactive' : ''}">
                        <div class="indexer-header">
                            <div class="indexer-info">
                                <div class="indexer-avatar">${indexerAvatar}</div>
                                <div class="indexer-details-header">
                                    <div class="indexer-name">${indexerName}${stakeCountBadge}</div>
                                    ${indexerDescription ? `<div class="indexer-description">${indexerDescription}</div>` : ''}
                                    <div class="indexer-links">
                                        ${indexerWebsite !== '#' ? `<a href="${indexerWebsite}" target="_blank" class="indexer-url">üåê Website</a>` : ''}
                                    </div>
                                    <div class="created-date">Active since ${createdDate}</div>
                                </div>
                            </div>
                            <div class="status-badge ${statusClass}">
                                ${statusText}
                            </div>
                        </div>
                        
                        <div class="delegation-stats">
                            <div class="delegation-stat">
                                <div class="delegation-stat-value">${stakedAmount} GRT</div>
                                <div class="delegation-stat-label">Total Staked</div>
                            </div>
                            <div class="delegation-stat">
                                <div class="delegation-stat-value gain-positive">${unrealizedRewardsFormatted} GRT</div>
                                <div class="delegation-stat-label">Unrealized Rewards</div>
                            </div>
                            <div class="delegation-stat">
                                <div class="delegation-stat-value">${realizedRewards} GRT</div>
                                <div class="delegation-stat-label">Realized Rewards</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            const filtersHTML = hasInactive ? `
                <div class="filters-section">
                    <button class="filter-btn" data-filter="inactive" onclick="toggleInactiveFilter()">
                        üëÅÔ∏è Show Inactive
                    </button>
                </div>
            ` : '';

            resultsDiv.innerHTML = `
                <div class="portfolio-summary">
                    <div class="portfolio-title">
                        üíº Portfolio Summary
                    </div>
                    <div class="portfolio-stats">
                        <div class="stat-item">
                            <div class="stat-value">${totalStaked} GRT</div>
                            <div class="stat-label">Total Staked</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${totalRealized} GRT</div>
                            <div class="stat-label">Realized Rewards</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${activeStakes}</div>
                            <div class="stat-label">Active Stakes</div>
                        </div>
                        <div class="stat-item">
                            <div class="stat-value">${uniqueIndexers}</div>
                            <div class="stat-label">Unique Indexers</div>
                        </div>
                    </div>
                </div>
                
                ${filtersHTML}
                
                <h2 class="section-title">üéØ Indexers (${uniqueIndexers} total, ${totalStakes} stakes)</h2>
                ${delegationsHTML || '<p style="text-align: center; color: var(--text-secondary); font-size: 1.1rem;">No delegations found.</p>'}
            `;

            // Reset filter state
            showInactive = false;
        }

        // Initialize theme on page load
        window.addEventListener('load', () => {
            loadTheme();
            const defaultAddress = document.getElementById('walletInput').value;
            if (defaultAddress) {
                analyzeDelegations();
            }
        });
    </script>
</body>
</html>